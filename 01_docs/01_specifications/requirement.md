# 要件定義書

## FF14 零式タイムライン管理ツール

| 項目 | 内容 |
|------|------|
| プロジェクト名 | FF14 零式タイムライン管理ツール |
| バージョン | 1.0.0 |
| 作成日 | 2026-01-19 |
| ステータス | ドラフト |

---

## 1. 概要

### 1.1 背景
FF14（ファイナルファンタジーXIV）の高難易度コンテンツ（零式レイド）では、8人のパーティメンバーが複雑なギミック（ボスの攻撃パターン）に対応するため、事前にタイムラインを共有・管理する必要がある。

### 1.2 目的
- ボスのギミックタイムラインを視覚的に管理する
- パーティメンバー各自のスキル使用タイミングを計画・共有する
- 固定パーティ間でタイムラインパターンを共有する

### 1.3 対象ユーザー
- FF14の高難易度コンテンツに挑戦するプレイヤー
- 固定パーティのリーダーおよびメンバー
- レイド攻略情報を共有したい配信者・攻略サイト運営者

---

## 2. システム構成

### 2.1 技術スタック
| 項目 | 技術 |
|------|------|
| フレームワーク | Vue.js 3 (Composition API) |
| 状態管理 | Pinia |
| スタイリング | Tailwind CSS |
| ビルドツール | Vite |
| データ保存 | window.storage API（共有ストレージ） |

### 2.2 動作環境
- モダンブラウザ（Chrome, Firefox, Edge, Safari 最新版）
- レスポンシブ対応（デスクトップ優先、モバイル対応）

---

## 3. 機能要件

### 3.1 パーティ管理機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-001 | ボス名設定 | コンテンツ/ボス名をテキスト入力で設定 | 必須 |
| F-002 | パーティ名設定 | 固定パーティの名前を設定 | 必須 |
| F-003 | ジョブ構成管理 | 8人分のジョブを選択・設定 | 必須 |
| F-004 | プレイヤー名設定 | 各メンバーにプレイヤー名を設定（任意） | 任意 |
| F-005 | メンバー並び替え | ドラッグ&ドロップでジョブ行を並び替え | 必須 |

#### ジョブ一覧
| ロール | ジョブ | 表示色 |
|--------|--------|--------|
| タンク | ナイト、戦士、ガンブレイカー、暗黒騎士 | 青 |
| ヒーラー | 白魔道士、学者、占星術師、賢者 | 緑 |
| DPS | モンク、竜騎士、忍者、侍、リーパー、ヴァイパー、吟遊詩人、機工士、踊り子、黒魔道士、召喚士、赤魔道士、ピクトマンサー | 赤 |

### 3.2 フェーズ管理機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-010 | フェーズ追加 | 新しいフェーズを追加（前フェーズの終了時刻から自動開始） | 必須 |
| F-011 | フェーズ編集 | 名称、通称、終了時刻を編集 | 必須 |
| F-012 | フェーズ削除 | フェーズを削除（関連ギミックも削除） | 必須 |
| F-013 | フェーズリサイズ | 右端ドラッグで終了時刻を調整 | 必須 |
| F-014 | フェーズ開閉 | 矢印ボタンでフェーズ内ギミックの表示/非表示 | 必須 |
| F-015 | 自動連結 | 次フェーズの開始時刻を前フェーズ終了時刻に自動連動 | 必須 |

#### フェーズデータ構造
```typescript
interface Phase {
  id: number;
  name: string;        // フェーズ名（例: インセインエアー2回目）
  nickname: string;    // 通称（例: 空中技）
  startTime: number;   // 開始時刻（秒）
  endTime: number;     // 終了時刻（秒）
  color: string;       // カラーコード
}
```

### 3.3 ギミック管理機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-020 | ギミック追加 | タイムライン上クリックで追加 | 必須 |
| F-021 | ギミック移動 | ドラッグ&ドロップで時間軸上を移動 | 必須 |
| F-022 | ギミック名変更 | ダブルクリックで名前変更 | 必須 |
| F-023 | ギミック詳細編集 | 右クリックでプロパティ編集メニュー表示 | 必須 |
| F-024 | ギミック削除 | 削除ボタンまたは右クリックメニューから削除 | 必須 |
| F-025 | 詠唱バー表示 | 詠唱時間をオレンジ色バーで表示 | 必須 |
| F-026 | 担当グループ設定 | MT/ST組などの担当を設定（任意） | 任意 |

#### ギミックデータ構造
```typescript
interface Gimmick {
  id: number;
  name: string;           // ギミック名
  startTime: number;      // 発動開始時刻（秒）
  castDuration: number;   // 詠唱時間（秒）
  effectDuration: number; // 効果時間（秒）
  phaseId: number;        // 所属フェーズID
  assignedGroup: string | null; // 担当グループ
}
```

#### ギミック視覚表現
| 要素 | 色 | 内容 |
|------|-----|------|
| 詠唱バー | オレンジ (bg-orange-600) | 詠唱時間を表示 |
| 発動エフェクト | 赤 (bg-red-600) | ギミック名と開始時刻を表示 |

### 3.4 スキル管理機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-030 | スキル追加 | ジョブ行クリックでスキル追加 | 必須 |
| F-031 | スキル編集 | クリックでスキル詳細を編集 | 必須 |
| F-032 | スキル削除 | スキルを削除 | 必須 |
| F-033 | バフ効果表示 | バフ継続時間を上部に細い線で表示 | 必須 |
| F-034 | バフ重複警告 | バフがギミックと重なると黄色＋★マーク | 必須 |
| F-035 | ターゲット設定 | スキルのターゲットを設定 | 必須 |

#### スキルデータ構造
```typescript
interface Skill {
  id: number;
  memberId: number;       // 使用メンバーID
  time: number;           // 発動時刻（秒）
  skillName: string;      // スキル名
  skillType: 'weaponskill' | 'ability'; // スキル種別
  target: string;         // ターゲット
  duration: number;       // 継続時間（秒）
  buffDuration: number;   // バフ効果時間（秒）
}
```

### 3.5 タイムライン表示機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-040 | 横型タイムライン | 左から右へ時間が流れるレイアウト | 必須 |
| F-041 | 時間軸表示 | 30秒刻みで目盛り表示（M:SS形式） | 必須 |
| F-042 | 横スクロール | タイムライン上でホイール操作 | 必須 |
| F-043 | 縦スクロール | 行頭エリアでホイール操作 | 必須 |
| F-044 | スケール設定 | 1秒 = 3ピクセル（デフォルト） | 必須 |
| F-045 | タイムライン長設定 | 設定画面から秒数指定（デフォルト600秒） | 必須 |

#### 行構成（上から順）
1. フェーズ行
2. 時間軸行
3. ギミック行
4. ジョブ行 × 8

### 3.6 データ永続化機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-050 | パターン保存 | 現在のタイムラインをパターンとして保存 | 必須 |
| F-051 | パターン読込 | 保存済みパターンを読み込み | 必須 |
| F-052 | パターン削除 | 保存済みパターンを削除 | 必須 |
| F-053 | パターン一覧 | 保存済みパターンをグリッド表示 | 必須 |
| F-054 | URL共有 | 現在のページURLを共有 | 必須 |

#### ストレージ仕様
- キー形式: `ff14-pattern:{id}`
- 共有ストレージ使用（shared: true）

### 3.7 設定機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-060 | タイムライン長設定 | 秒数で指定（デフォルト600秒） | 必須 |
| F-061 | ターゲット管理 | ターゲットの追加・削除 | 必須 |

#### デフォルトターゲット
- ボス
- 雑魚A
- 雑魚B

---

## 4. 非機能要件

### 4.1 パフォーマンス
| ID | 要件 | 基準 |
|----|------|------|
| NF-001 | 初期表示 | 3秒以内 |
| NF-002 | 操作レスポンス | 100ms以内 |
| NF-003 | スクロール | 60fps維持 |

### 4.2 ユーザビリティ
| ID | 要件 | 基準 |
|----|------|------|
| NF-010 | 操作説明 | 画面下部にヘルプテキスト表示 |
| NF-011 | レスポンシブ | デスクトップ・タブレット対応 |
| NF-012 | ダークモード | ダーク系カラースキームを基本 |

### 4.3 セキュリティ
| ID | 要件 | 基準 |
|----|------|------|
| NF-020 | XSS対策 | Vueの自動エスケープ使用、v-html禁止 |
| NF-021 | 入力検証 | 全入力値をクライアント側で検証 |
| NF-022 | データ整合性 | JSON.parse時のtry-catchエラーハンドリング |

---

## 5. UI仕様

### 5.1 カラースキーム
| 要素 | 色 |
|------|-----|
| 背景 | グラデーション（slate-900 → purple-900 → slate-900） |
| パネル | slate-800/90（半透明）+ purple-500/30ボーダー |
| 保存ボタン | purple-600 |
| 共有ボタン | blue-600 |
| タンク | blue-600 |
| ヒーラー | green-600 |
| DPS | red-600 |

### 5.2 レイアウト定数
| 項目 | 値 |
|------|-----|
| 行ラベル幅 | 128px (w-32) |
| 1秒あたりピクセル | 3px |
| デフォルトタイムライン長 | 600秒 |
| 時間目盛り間隔 | 30秒 |
| 最大表示高さ | 600px |

---

## 6. 将来の拡張

以下の機能は将来のバージョンで検討：

- スキルのドラッグ&ドロップ移動
- MT組/ST組のグループ管理機能
- タイムラインのズーム機能
- JSON形式でのエクスポート/インポート
- 印刷用レイアウト
- スキルアイコン表示
- 複数タイムラインの比較表示

---

## 7. 用語定義

| 用語 | 説明 |
|------|------|
| 零式 | FF14の最高難易度8人レイドコンテンツ |
| ギミック | ボスが繰り出す攻撃パターンや処理が必要な仕組み |
| フェーズ | 戦闘の区切り、ボスの状態変化ごとの期間 |
| 詠唱 | ボスが技を発動するまでの準備時間 |
| バフ | プレイヤーに付与される一時的な強化効果 |
| MT/ST | メインタンク/サブタンク |
| 固定パーティ | 定期的に一緒にプレイするメンバー構成 |
