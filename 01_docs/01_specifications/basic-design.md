# 基本設計書

## FF14 零式タイムライン管理ツール

| 項目 | 内容 |
|------|------|
| 作成日 | 2026-01-19 |
| 更新日 | 2026-01-20 |
| ステータス | 完了 |

---

## 1. アーキテクチャ

### 1.1 動作環境
- **ブラウザアプリ（静的HTML/JS）**
- サーバー不要
- モダンブラウザ対応（Chrome, Firefox, Edge, Safari）

### 1.2 データ構造（2層構成）

```
┌─────────────────────────────────────────────────────────────┐
│  コンテンツ（ボスタイムライン）← 共通テンプレート           │
│  ├─ レイド名（フォルダ名）                                  │
│  ├─ ボス名                                                 │
│  ├─ タイムライン長                                         │
│  ├─ ターゲット一覧                                         │
│  ├─ フェーズ一覧                                           │
│  ├─ ギミック一覧                                           │
│  └─ バーストタイミング一覧                                 │
│      → 編集モード時のみ変更可能                            │
│      → JSONファイルとしてサブフォルダに配置                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  パーティ構成 ← 固定パーティごとに作成                      │
│  ├─ パーティ名                                             │
│  ├─ 対象コンテンツID                                       │
│  └─ メンバー（1〜8人）                                     │
│       ├─ プレイヤー名                                      │
│       ├─ ロール（Tank/Healer/DPS）                         │
│       ├─ ジョブ                                            │
│       └─ スキル配置[]                                      │
│      → 通常モードで編集可能                                │
│      → ローカルストレージに自動保存                        │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 フォルダ構成

```
project/
├── index.html
├── src/
│   └── ...
└── data/
    ├── contents/                          # コンテンツデータ
    │   ├── アルカディア・ヘビー級零式/
    │   │   ├── 1層.json
    │   │   ├── 2層.json
    │   │   ├── 3層.json
    │   │   └── 4層.json
    │   └── アルカディア・クルーザー級零式/
    │       ├── 1層.json
    │       └── ...
    └── skills/                            # スキルマスターデータ
        └── jobs.json
```

---

## 2. データ保存方式

| 対象 | 保存場所 | 自動保存 | 手動保存 |
|------|---------|---------|---------|
| コンテンツ | サブフォルダ内JSON | なし | JSONダウンロード→手動配置 |
| パーティ構成 | ローカルストレージ | デバウンス（操作後2秒） | JSONダウンロード |
| スキルマスター | サブフォルダ内JSON | なし | 手動管理 |

### 読み込み
- コンテンツ: アプリ起動時にフォルダから読み込み
- パーティ: ローカルストレージ or JSONインポート

---

## 3. 画面設計

### 3.1 画面モード

| モード | 説明 | 編集可能な項目 |
|--------|------|---------------|
| 通常モード | パーティのスキル配置を行う | スキル配置、メンバー編集 |
| 編集モード | コンテンツ（ボス/ギミック）を作成・編集 | フェーズ、ギミック、バーストタイミング、タイムライン長、ターゲット |

### 3.2 ヘッダーレイアウト

**通常モード:**
```
┌──────────────────────────────────────────────────────────────┐
│ [ボス選択 ▼] [パーティ選択 ▼] [パーティ管理] [設定] [保存]  │
└──────────────────────────────────────────────────────────────┘
```

**編集モード:**
```
┌──────────────────────────────────────────────────────────────┐
│ [編集中: ボス名]                         [編集終了] [保存]  │
└──────────────────────────────────────────────────────────────┘
```

### 3.3 ボス選択UI（カスケードメニュー）

```
[ボス選択 ▼]
├─ アルカディア・ヘビー級零式 ▶ ├─ 1層
│                              ├─ 1層（編集）
│                              ├─ 2層
│                              ├─ 2層（編集）
│                              └─ ...
├─ アルカディア・クルーザー級零式 ▶ ...
├─ ─────────────────────────
└─ ＋新規作成
```

### 3.4 メイン画面構成

```
┌─────────────────────────────────────────────────────────────┐
│  ヘッダー（固定）                                           │
├────────┬────────────────────────────────────────────────────┤
│        │  ← 横スクロール領域 →                              │
│ 行頭   ├────────────────────────────────────────────────────┤
│ (固定) │  フェーズ行（固定）                                │
│        ├────────────────────────────────────────────────────┤
│        │  時間行（固定）                                    │
│        ├────────────────────────────────────────────────────┤
│        │  ギミック行（固定）                                │
├────────┼────────────────────────────────────────────────────┤
│ Job行頭│  ジョブ行 ← 縦スクロール可能                       │
│ (固定) │  ジョブ行                                          │
│        │  ...                                               │
├────────┴────────────────────────────────────────────────────┤
│  ヘルプテキスト（固定）                                     │
└─────────────────────────────────────────────────────────────┘
```

### 3.5 レイアウト要件

| 要件 | 内容 |
|------|------|
| 全体 | 画面内に収める（ページ全体のスクロール不要） |
| 行頭（ジョブ名等） | 固定列として常時表示 |
| フェーズ/時間/ギミック行 | 縦スクロールしない（固定） |
| ジョブ行 | 縦スクロール可能 |

### 3.6 バーストタイミング表示

- タイムライン全体の背景にハイライト（フェーズ、時間、ギミック、ジョブ行すべて）
- 背景色: 薄黄色
- 初期配置: 0分、2分、4分...と自動生成
- 編集: ドラッグで移動、追加・削除可能
- 名前: 任意で設定可能（「開幕」「2分」等）

---

## 4. 操作仕様

### 4.1 スクロール・ズーム

| 操作 | 動作 |
|------|------|
| タイムライン上でホイール | 横スクロール |
| ジョブ行頭でホイール | ジョブ行の縦スクロール |
| Shift + ホイール | ズーム（スケール変更） |
| ピンチ（タッチ） | ズーム |
| 虫眼鏡アイコン（＋/−） | ズーム |

※時間目盛り間隔はズームスケールに応じて自動調整

### 4.2 メンバー編集（インライン）
- ジョブ: ドロップダウンで選択（常時表示）
- プレイヤー名: 入力欄として常時表示

### 4.3 スキル操作

| 操作 | 動作 |
|------|------|
| ジョブ行クリック | そのジョブのスキル一覧がポップアップ → 選択して配置 |
| スキルをドラッグ | 時刻を移動 |
| スキルをクリック | 選択状態 → その場にドロップダウン表示 → スキル変更可能 |
| スキルを右クリック | 削除メニュー表示 |

### 4.4 ギミック操作（編集モード時のみ）

| 操作 | 動作 |
|------|------|
| ギミック行クリック | その時刻にギミック追加 |
| ギミックをドラッグ | 時刻を移動 |
| ギミックをダブルクリック | 名前変更 |
| ギミックを右クリック | プロパティ編集メニュー |

### 4.5 フェーズ操作（編集モード時のみ）

| 操作 | 動作 |
|------|------|
| 追加ボタン | 新しいフェーズを追加（前フェーズ終了時刻から開始） |
| 右端ドラッグ | 終了時刻を調整 |
| 開閉ボタン | フェーズ内ギミックの表示/非表示 |

### 4.6 バーストタイミング操作（編集モード時のみ）

| 操作 | 動作 |
|------|------|
| ドラッグ | 時刻を移動 |
| ダブルクリック | 名前変更 |
| 右クリック | 削除メニュー |
| 追加ボタン | 新しいバーストタイミングを追加 |

---

## 5. モーダル一覧

### 5.1 パーティ管理モーダル
- パーティ一覧表示
- 新規作成
- 保存（ローカルストレージ）
- JSONダウンロード
- JSONインポート

### 5.2 コンテンツ設定モーダル（編集モード時）
- タイムライン長（秒）
- ターゲット管理（ボス、雑魚A等の追加・削除）

---

## 6. データ構造詳細

### 6.1 スキルマスターデータ

```typescript
interface Skill {
  id: string;           // 例: "TANK_REPRISAL"
  name: string;         // 例: "リプライザル"
  job: string | null;   // ジョブ固有の場合（例: "ナイト"）
  role: string | null;  // ロール共通の場合（例: "Tank"）
  recast: number;       // リキャスト秒
  duration: number;     // 効果時間秒
  type: "軽減" | "バフ" | "バリア" | "薬";
  icon?: string;        // 将来用（パスまたはURL）
}
```

**スキル範囲:** 軽減・バフ系、薬のみ（GCDスキルは対象外）

**アイコン方針:**
- 初期: テキスト＋色分け
- 将来: 著作権クリア後に公式アイコン対応

### 6.2 ジョブ一覧

| ロール | ジョブ | 表示色 |
|--------|--------|--------|
| タンク | ナイト、戦士、ガンブレイカー、暗黒騎士 | 青 |
| ヒーラー | 白魔道士、学者、占星術師、賢者 | 緑 |
| DPS | モンク、竜騎士、忍者、侍、リーパー、ヴァイパー、吟遊詩人、機工士、踊り子、黒魔道士、召喚士、赤魔道士、ピクトマンサー | 赤 |

### 6.3 コンテンツJSON

```typescript
interface Content {
  id: string;                    // 一意ID
  raidName: string;              // レイド名（例: "アルカディア・ヘビー級零式"）
  bossName: string;              // ボス名（例: "1層"）
  duration: number;              // タイムライン長（秒）
  targets: string[];             // ターゲット一覧（例: ["ボス", "雑魚A"]）
  phases: Phase[];               // フェーズ一覧
  gimmicks: Gimmick[];           // ギミック一覧
  burstTimings: BurstTiming[];   // バーストタイミング一覧
}

interface Phase {
  id: string;
  name: string;           // フェーズ名
  startTime: number;      // 開始時刻（秒）
  endTime: number;        // 終了時刻（秒）
  color: string;          // 表示色
}

interface Gimmick {
  id: string;
  name: string;           // ギミック名
  time: number;           // 発動時刻（秒）
  castDuration: number;   // 詠唱時間（秒）
  phaseId: string;        // 所属フェーズID
}

interface BurstTiming {
  id: string;
  name?: string;          // 名前（任意）
  startTime: number;      // 開始時刻（秒）
  endTime: number;        // 終了時刻（秒）
}
```

### 6.4 パーティJSON

```typescript
interface Party {
  id: string;                    // 一意ID
  name: string;                  // パーティ名（例: "固定パーティA"）
  contentId: string;             // 対象コンテンツID
  members: Member[];             // メンバー一覧（1〜8人）
  createdAt: string;             // 作成日時
  updatedAt: string;             // 更新日時
}

interface Member {
  id: string;
  order: number;                 // 表示順
  playerName?: string;           // プレイヤー名（任意）
  role: "Tank" | "Healer" | "DPS";
  job: string;                   // ジョブ名（例: "ナイト"）
  skillPlacements: SkillPlacement[];  // スキル配置
}

interface SkillPlacement {
  id: string;
  skillId: string;               // スキルマスターのID
  time: number;                  // 発動時刻（秒）
  target?: string;               // ターゲット（任意）
}
```

---

## 7. エラーハンドリング

### 7.1 エラー表示方針

| エラー種別 | 重大度 | 表示方法 |
|-----------|--------|---------|
| JSON読み込み失敗 | 重大 | モーダルダイアログ |
| ローカルストレージ容量超過 | 重大 | モーダルダイアログ |
| JSONインポート失敗 | 中 | モーダルダイアログ（詳細表示） |
| 自動保存失敗 | 軽微 | トースト通知 |
| 操作エラー（軽微） | 軽微 | トースト通知 |
| 必須データ欠損 | - | インライン（操作無効化＋ガイド） |

---

## 8. 注意書き（ユーザー向け）

### コンテンツ新規作成時
```
⚠ 新規作成について
保存したJSONファイルは、以下の場所に手動で配置してください:
  data/contents/[レイド名]/[ボス名].json
配置後、ページを再読み込みすると反映されます。
新しいレイド（フォルダ）を追加する場合は、手動でフォルダを作成してください。
```
