# リリースノート

## 2026-01-22

### 新機能

#### スキル干渉のアラート表示
- ロールスキルが複数のメンバーで同時に使われている場合に干渉を検知
- 干渉があるスキルには赤い縁と警告アイコン（⚠️）を表示
- ツールチップで干渉しているメンバー名を確認できます
- 同じスキルの効果時間が重複している場合に警告されます

#### 軽減率グラフへのツールチップ追加
- 軽減率グラフにマウスオーバーすると、その時刻の軽減率を表示
- 物理軽減率と魔法軽減率を%で確認できます
- 時刻も「分:秒」形式で表示されます

#### スキル行の複数行化（レーンシステム）
- 各メンバーに4つのレーン（行）を追加し、スキルを複数行に配置可能に
- スキル追加・移動時に空いているレーンを自動選択
- リキャストタイム中に別のスキルを使用する際も干渉せず配置できます
- レーン番号（L2〜L4）を行頭に表示
- スキルの時間的な重複を自動検知し、最適なレーンに配置

#### 軽減率の無敵スキル対応
- タンクの無敵スキル（無敵受け）を「無敵」として扱えるようになりました
- Skill型にinvincibleプロパティを追加
- 無敵スキルがアクティブな時間帯はグラフに金色のハイライトを表示
- ツールチップで「⭐ 無敵」と表示
- 無敵時は軽減率を自動的に100%に設定

### バグ修正

#### パーティリストのスクロール同期の問題を修正
- 行頭とメンバーエリアの縦スクロールが同期するように修正
- スクロール無限ループを防止するフラグを実装
- 行頭をスクロールするとタイムライン側も連動してスクロール
- タイムライン側をスクロールすると行頭も連動してスクロール

#### タイムラインスクロールの不具合を修正
- タイムライン上でマウスホイールを使った際、横スクロールのみ発生するように修正
- MemberAreaコンポーネントのホイールイベントを親に委譲
- 通常のホイールスクロールを横スクロールに変換
- Shiftキー押下時はズーム機能（既存の動作を維持）

#### 同じスキル干渉時の軽減率加算バグを修正
- 同じスキルが複数メンバーで使われている場合、効果が重複カウントされないように修正
- skillIdごとにMapを使って重複を排除し、正確な軽減率を表示
- 異なるスキルの軽減率のみ加算されるように改善

### 改善

#### 軽減率グラフの視認性向上
- 物理と魔法で統一されたスケールを使用（両方の最大値を10の倍数に切り上げ）
- 10%ごとに補助線（グリッドライン）を表示
- 各補助線にパーセンテージのラベルを追加
- 軽減率が一目でわかるように視覚的に改善

#### スキル名のスクロール追従
- 行頭部分にposition: stickyを追加
- 横スクロール時にメンバー名が常に表示されるように固定
- タイムラインの操作性が向上

### 変更されたファイル

#### 新規作成
- `src/composables/useSkillInterference.ts` - スキル干渉検知ロジック
- `src/composables/useSkillLane.ts` - レーン選択ロジック

#### 更新
- `src/types/skill.ts` - invincibleプロパティを追加
- `src/types/party.ts` - SkillPlacement型にlaneプロパティを追加
- `src/stores/partyStore.ts` - スキル追加・更新時の自動レーン選択
- `src/components/timeline/MemberRow.vue` - 4レーン表示対応
- `src/components/timeline/MemberArea.vue` - scrollイベントとref公開、wheelイベント委譲
- `src/components/timeline-items/SkillBar.vue` - 干渉検知の統合、警告表示
- `src/components/timeline/MitigationGraph.vue` - マウスオーバーツールチップ、補助線、スケーリング、無敵ハイライト
- `src/composables/useMitigationAggregation.ts` - 重複スキル排除ロジック、無敵判定
- `src/components/Timeline.vue` - 行頭固定（position: sticky）、4レーン対応、スクロール同期、wheelイベント処理
- `RELEASE_NOTES.md` - リリースノート更新
- `課題管理表.md` - 完了済み課題の更新

### セキュリティ対応

#### OWASP準拠
- 入力値検証: スキル配置IDによる干渉検知は型安全に実装されています
- XSS対策: ツールチップ表示はVueのテンプレート構文で自動エスケープされます
- データ整合性: Map構造を使用した重複排除により、データの正確性を保証
- 型安全性: TypeScriptの型システムでレーン番号を厳密に管理（0〜3の範囲）
- データ検証: 無敵フラグはboolean型で厳密に管理

---

## 2026-01-21

### 新機能

#### スキルのドラッグ時に垂直線を表示
- スキルをドラッグする際、開始位置（黄色の垂直線）と終了位置（青色の垂直線）が表示されるようになりました
- これにより、スキルの配置をより正確に行えるようになります

#### パーティスキルの効果情報の表示
- すべてのスキルに物理軽減率、魔法軽減率、バフ効果の情報を追加しました
- スキルバーにマウスオーバーすると、ツールチップで効果情報が確認できます
  - 例: 「ランパート (90秒) 物理軽減20%, 魔法軽減20%」

#### パーティスキルの効果集計
- タイムライン上でパーティ全体の軽減効果を自動集計する機能を追加しました
- メンバーエリアの先頭に物理軽減（青色）と魔法軽減（紫色）のエリアグラフを表示
- 1秒単位でリアルタイムに軽減率を計算・表示
- スキルの配置を変更すると、集計グラフも自動的に更新されます

#### スキルのキャストタイム、リキャストタイムの表示
- スキルにキャストタイムとリキャストタイムを追加しました
- キャストタイム: 黄色の縁とピンク系の内部で表示（スキル発動前の準備時間）
- 効果時間: 既存のカラフルなバーで表示（スキルが効果を発揮する時間）
- リキャストタイム: グレーの半透明で表示（再使用までの待機時間）
- スキルの状態が視覚的にわかりやすくなりました

### 改善

#### 課題管理表の整理
- 完了済みの課題を「完了済み課題」セクションに移動しました
- 重複していた古い課題を削除しました
- 未着手の課題を優先度別に整理しました

### セキュリティ対応

#### OWASP準拠
- 入力値検証: スキルの効果情報はJSONで定義され、型安全に管理されています
- データ整合性: 効果情報はオプショナルフィールドとして定義し、存在しない場合でも安全に動作します

### 変更されたファイル

#### 新規作成
- `src/components/ui/SkillDragLines.vue` - スキルドラッグ時の垂直線表示コンポーネント
- `src/composables/useMitigationAggregation.ts` - 軽減効果集計ロジック
- `src/components/timeline/MitigationGraph.vue` - 軽減効果グラフ表示コンポーネント

#### 更新
- `src/types/skill.ts` - Skill型に効果情報フィールド（physicalMitigation, magicalMitigation, buffPower）とcastTimeを追加
- `src/stores/uiStore.ts` - スキルドラッグ中の位置情報を管理する状態と関数を追加
- `src/components/Timeline.vue` - SkillDragLinesコンポーネントを統合、軽減効果集計行のヘッダーを追加
- `src/components/timeline/MemberArea.vue` - 軽減効果集計グラフを統合
- `src/components/timeline-items/SkillBar.vue` - スキルドラッグ時の垂直線位置設定、効果情報表示、キャスト/リキャストタイム表示を追加
- `public/data/skills/jobs.json` - 全スキルに効果情報とcastTimeを設定
- `課題管理表.md` - 完了済み課題の整理と更新

### 今後の予定

#### 優先度：中
- パーティメンバー間でのスキル干渉のアラート

#### 優先度：低
- スキル名をスクロールに追従させる機能
